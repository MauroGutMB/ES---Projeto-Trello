<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Project Manager</title>
    <!-- CSS Linkado -->
    <link rel="stylesheet" href="src/css/style.css">
    <!-- FontAwesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body class="login-body">
    
    <div id="toast-box" class="toast-container"></div>

    <div class="login-wrapper">
        <!-- FORMULÁRIO DE LOGIN -->
        <div id="login-form" class="form-container">
            <div class="login-header">
                <i class="fa-solid fa-layer-group"></i>
                <h2>Bem-vindo de volta!</h2>
                <p>Acesse seus projetos e tarefas</p>
            </div>
            
            <div class="input-group">
                <i class="fa-solid fa-envelope input-icon"></i>
                <input type="email" id="login-email" class="login-input" placeholder="Seu e-mail" style="padding-left: 40px;">
            </div>
            
            <div class="input-group">
                <i class="fa-solid fa-lock input-icon"></i>
                <input type="password" id="login-pass" class="login-input" placeholder="Sua senha" style="padding-left: 40px;">
            </div>

            <button class="btn-login" onclick="handleLogin()">Entrar</button>
            
            <div class="toggle-link">
                Não tem uma conta? <span onclick="toggleForms()">Crie agora</span>
            </div>
        </div>

        <!-- FORMULÁRIO DE CADASTRO -->
        <div id="register-form" class="form-container hidden">
            <div class="login-header">
                <i class="fa-solid fa-user-plus"></i>
                <h2>Criar Conta</h2>
                <p>Comece a organizar seus projetos</p>
            </div>

            <div class="input-group">
                <i class="fa-solid fa-user input-icon"></i>
                <input type="text" id="reg-name" class="login-input" placeholder="Nome Completo" style="padding-left: 40px;">
            </div>

            <div class="input-group">
                <i class="fa-solid fa-envelope input-icon"></i>
                <input type="email" id="reg-email" class="login-input" placeholder="E-mail" style="padding-left: 40px;">
            </div>

            <div class="input-group">
                <i class="fa-solid fa-lock input-icon"></i>
                <input type="password" id="reg-pass" class="login-input" placeholder="Senha" style="padding-left: 40px;">
            </div>
            
            <div class="input-group">
                <i class="fa-solid fa-graduation-cap input-icon"></i>
                <select id="reg-role" class="login-input" onchange="toggleClassInput()" style="padding-left: 40px;">
                    <option value="aluno">Sou Aluno</option>
                    <option value="professor">Sou Professor</option>
                </select>
            </div>
            
            <div id="class-group-container" class="input-group">
                <i class="fa-solid fa-users input-icon"></i>
                <input type="text" id="reg-class" class="login-input" placeholder="Sua Turma (Ex: 3A, DS2)" style="padding-left: 40px;">
            </div>

            <button class="btn-login" onclick="handleRegister()">Cadastrar</button>
            
            <div class="toggle-link">
                Já tem conta? <span onclick="toggleForms()">Fazer Login</span>
            </div>
        </div>
    </div>

    <script>
        function showToast(msg, type='success') {
            const box = document.getElementById('toast-box');
            const div = document.createElement('div');
            div.className = `toast ${type}`;
            // Adicionando estilo inline básico para o toast funcionar sem mexer muito no CSS global
            div.style.cssText = `
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white; padding: 12px 20px; border-radius: 8px;
                margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                display: flex; align-items: center; gap: 10px; animation: fadeIn 0.3s;
                position: fixed; top: 20px; right: 20px; z-index: 2000;
            `;
            div.innerHTML = `<i class="fa-solid ${type==='success'?'fa-check':'fa-circle-exclamation'}"></i> ${msg}`;
            box.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        function toggleForms() {
            const loginForm = document.getElementById('login-form');
            const regForm = document.getElementById('register-form');
            
            if (loginForm.classList.contains('hidden')) {
                // Mostrar Login
                regForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            } else {
                // Mostrar Cadastro
                loginForm.classList.add('hidden');
                regForm.classList.remove('hidden');
            }
        }

        function toggleClassInput() {
            const role = document.getElementById('reg-role').value;
            const classInput = document.getElementById('class-group-container');
            if(role === 'professor') classInput.classList.add('hidden');
            else classInput.classList.remove('hidden');
        }

        // --- LÓGICA DE BANCO DE DADOS (LOCALSTORAGE) ---
        function getDB(key) { return JSON.parse(localStorage.getItem(key)) || []; }
        function setDB(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

        function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;
            const role = document.getElementById('reg-role').value;
            const turma = document.getElementById('reg-class').value;

            if(!name || !email || !password) return showToast('Preencha os campos obrigatórios', 'error');
            if(role === 'aluno' && !turma) return showToast('Informe sua turma', 'error');

            const users = getDB('usersDB');
            if(users.find(u => u.email === email)) return showToast('E-mail já cadastrado', 'error');

            const newUser = {
                id: Date.now(),
                name, email, password, role,
                turma: role === 'aluno' ? turma : 'Docente',
                avatar: name.charAt(0).toUpperCase()
            };

            users.push(newUser);
            setDB('usersDB', users);
            showToast('Conta criada! Faça login.');
            
            // Pequeno delay para voltar pro login
            setTimeout(toggleForms, 1500);
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            
            const user = getDB('usersDB').find(u => u.email === email && u.password === pass);

            if(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
                showToast(`Bem-vindo, ${user.name}!`);
                
                setTimeout(() => {
                    if(user.role === 'professor') window.location.href = 'Professor.html';
                    else window.location.href = 'Trello.html';
                }, 1000);
            } else {
                showToast('E-mail ou senha incorretos', 'error');
            }
        }
    </script>
</body>
</html>